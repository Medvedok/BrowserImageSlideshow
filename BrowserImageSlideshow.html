<!DOCTYPE html>
<!--

BrowserImageSlideshow
https://github.com/dustymethod/BrowserImageSlideshow
https://obsproject.com/forum/threads/browser-image-slideshow.110157/

-->
<div id="imageContainer"></div>
<style>
    *{
        border-color: transparent;
        background-color: transparent;
    }
    img {
        position: fixed;
        object-fit:contain;
        width: 100%;
        height: 100%;
        border-color: transparent;
    }

    body {
        background-color: transparent;
        margin: auto;
        overflow: hidden;
    }
</style>

<script src="jquery-3.4.1.min.js"></script>
<script src="images/images.js"></script>
<script src="settings.js"></script>
<script>
    
    // modes (defined in settings.js):
    // 0: Random order (default)
    // 1: Alphabetical order
    // 2: Alphabetical order (start on random image)
    
    // setup image src strings
    let images = imageNamesStr.split("\n");
    images.shift();
    images.pop();
    for (let i = images.length-1; i >= 0; i--) {
        // remove js, sh, or directory
        let remove = images[i].includes(".js") || images[i].includes(".sh") || !images[i].includes(".") || images[i].includes(".git");
        if (remove) {
            images.splice(i, 1);
        }
    }

    // setup indexes for shuffling
    let indexes = new Array();
    for(let i = 0; i < images.length; i++) {
        images[i] = "images/" + images[i];
        indexes.push(i);
    }
    
    // setup img elements
    let topImage = document.createElement("img");
    let botImage = document.createElement("img");
    let imageContainer = document.getElementById("imageContainer");
    imageContainer.appendChild(botImage);
    imageContainer.appendChild(topImage);
    topImage.id = "topImage";
    botImage.id = "botImage";
    
    // prevent white outline by setting initial transparency
    topImage.style.opacity = "0.0";
    botImage.style.opacity = "0.0";

    let fadeDuration = slideDuration * 0.25;
    let slideshowFunc;
    let tick = 0;
    let fadeInTop = true; // bool for deciding if top image fades in or out
    
    function shuffle(a) {
        for (let i = a.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [a[i], a[j]] = [a[j], a[i]];
        }
        return a;
    }

    function randomizeTick(max) {
        tick = Math.floor(Math.random() * max); // [0, max)
    }
    
    function nextSlide() {
        if (tick === images.length-1 && stopOnLastImage === true) {
            clearInterval(slideshowFunc); // stop slideshow on last slide
        } else {
            if (tick === images.length-1) { // if end of loop, start new loop
                if (mode === 0) {
                    shuffle(indexes);
                } else if (mode === 2) {
                    randomizeTick(images.length);
                }
                tick = 0;
            } else { // next slide
                tick++;
            }
        }

        fadeInTop = !fadeInTop;
    }
    
    function slideshow() {
        if (fadeInTop) {
            topImage.src = images[indexes[tick]];
            
            $("#botImage").animate(
                { opacity: 0.0 },
                { duration: fadeDuration }
            );
            
            $("#topImage").animate(
                { opacity: 1.0 },
                {
                    duration: fadeDuration,
                    done: nextSlide
                }
            );

        } else {
            botImage.src = images[indexes[tick]];
            
            $("#botImage").animate(
                { opacity: 1.0 },
                { duration: fadeDuration }
            );
            
            $("#topImage").animate(
                { opacity: 0.0 },
                {
                    duration: fadeDuration,
                    done: nextSlide
                }
            );
        }
    }
    
    if (mode === 0) { // random mode
        shuffle(indexes);
    } else if (mode === 2) { // choose random image to start on
        randomizeTick(images.length);
    }

    // if only 1 image in slide show, fade in the image
    if (images.length == 1) {
        botImage.src = images[indexes[0]];
        
        $("#botImage").animate(
            { opacity: 1.0 },
            { duration: fadeDuration }
        );

    // else start the slideshow
    } else if (images.length > 1) {
        slideshow();
        slideshowFunc = setInterval(slideshow, slideDuration);
    }
</script>
